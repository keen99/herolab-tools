<!-- version 306 -->

<!DOCTYPE html>
<style>
  @media print {

    /* THIS causes our columns to flow properly from page to page*/
    /* set page size and margins */
    @page {
      size: letter;
      margin: 1.5cm;
    }
  }


  .element-path {
    font-weight: lighter;
    font-size: 20%;
    float: right;
    display: inline-block
  }

  .name-heading {
    font-weight: bold;
    display: inline-block;
  }

  .description-text {
    /*white-space: pre-wrap;*/
    white-space: pre-wrap !important;
    /* The pre-wrap value preserves newlines and whitespace characters, while allowing text to wrap to the next line. You can use this property to achieve a similar effect to the <pre> element, without actually using the <pre> element in your HTML. */
    word-break: keep-all;
    /* to allow the text to break in between words if the text is too long. */
    font-size: 80%;
    /* match the <pre> style*/
    font-family: monospace;
    /*font-size: 14px;*/
    line-height: 1.5;
    color: #333;
  }

  /* Style the header */
  .page-header {
    /*position: absolute;*/
    /*top: 0;*/
    text-align: center;
    /*display: block;*/
    /*font-size: 20px;*/
    /*margin-bottom: 20px;*/
  }

  /* Style the footer */
  .page-footer {
    /*position: absolute;*/
    /*bottom: 0;*/
    text-align: center;
    /*display: block;*/
    /*font-size: 12px;*/
    /*margin-top: 20px;*/
  }

  .main-container {
    /*position: relative;*/
    min-height: 100%;
    display: flex;
    flex-direction: column;
  }

  .main-container-flex {
    display: flex;
    flex-direction: column;
    min-height: 100%;
  }

  .grid-container {
    flex: 1;
    /* This will make grid-container take the remaining space after header and footer */
    column-count: 2;
    /* creates two columns */
    column-gap: 10px;
    /* adds some space between columns */
    width: 80%;
    /* adjust as needed */
    margin: 0 auto;
    /* center the columns */
    margin: auto;
    /* center the columns */
  }

  @media screen and (max-width: 600px) {
    .grid-container {
      column-count: 1;
      /* 1 column for screen widths less than 600px */
    }
  }

  .grid-item {}

  .grid-item.container {
    border: 1px solid black;
    /*or any other border properties you would like*/
    padding: 10px;
    /* add some space between the border and the contents */
  }

/*#filterPaths, #filterNames {
    display: inline-block;
    vertical-align: top;
    width: 49%;
}
*/
#filterContainer{
    display: grid;
    grid-template-columns: 1fr 1fr;
}



</style>
<html>
  <head>
    <script >
      document.addEventListener("DOMContentLoaded", function() {
        document.getElementById("xml-file").onchange = function(){processXmlFile(false)};
      });
    </script>
    <script src="js/extractor.js"></script>
    <script src="js/utilities.js"></script>
    <script src="js/ignoredElements.js"></script>
  </head>
  <body>
    <div id="status">
    <!-- <div id="description"> -->
      <h2>HeroLab XML Data Extractor</h2>
      <p>This tool allows you to easily extract item, object, and power descriptions from HeroLab character sheets exported in XML format.</p>
      <p>To use the tool, start by exporting your HeroLab character sheet in XML format. In HeroLab, go to the File menu, select Save Custom Output, and choose Generate XML File. Save the file to your computer.</p>
      <p>Next, upload the XML file using the file input field on this page or use one of the provided sample files for a demo. The extracted data will be displayed on the page and can be saved as a PDF for future reference using your browser's Print function.</p>
       <ul>
        <li><a href="https://github.com/keen99/herolab-tools"> herolab-tools repo</a> - Source freely available on github</li>
      </ul>
    </div>

    <input type="file" id="xml-file" accept="application/xml, text/xml, .xml" onchange="processXmlFile(false)">
    <div id="xml-button">
      <button id="xml-button-1" onclick="processXmlFile('sample-xml/Bronn_Skyfall_L6.xml')">Sample -
        Bronn_Skyfall_L6.xml</button>
      <button id="xml-button-2" onclick="processXmlFile('sample-xml/Bronn_Skyfall_L7.xml')">Sample -
        Bronn_Skyfall_L7.xml</button>
      <button id="xml-button-3" onclick="processXmlFile('sample-xml/Flen_Nightinfire.6.xml')">Sample -
        Flen_Nightinfire.6.xml</button>
    </div>
    <div id="filterContainer">
      <div id="filterPaths"></div>
      <div id="filterNames"></div>
    </div>
    <input type="checkbox" id="path1" data-path-id="path1" onchange="updateUrlParams(this)">

<!-- 7 no lnger supports this mode because the author is an ass -->
<script src="https://unpkg.com/qs@6.9.4/dist/qs.js"></script>

<script>
// checkboxes for 3 things
            // // Define the options
            // var options = ["Everything Else", "Skills", "Spells"];

            // // Get the div element where the checkboxes will be added
            // var checkboxDiv = document.getElementById("checkboxes");

            // // Create a checkbox for each option
            // options.forEach(function(option) {
            //     var checkbox = document.createElement("input");
            //     checkbox.type = "checkbox";
            //     checkbox.value = option;
            //     checkbox.id = option;
            //     checkbox.name = "options";
            //     checkboxDiv.appendChild(checkbox);

            //     var label = document.createElement("label");
            //     label.htmlFor = option;
            //     label.innerHTML = option;
            //     checkboxDiv.appendChild(label);

            //     var br = document.createElement("br");
            //     checkboxDiv.appendChild(br);
            // });



window.addEventListener('load', function() {
    // code to execute when the page has finished loading
    // Get the current URL
    const url = new URL(window.location);
    // Get the search params
    const searchParams = new URLSearchParams(url.search);
    var checked = new Set();
    for (const [key, value] of searchParams.entries()) {
        var checkbox = document.getElementById(key);
        if (checkbox && !checked.has(key)) {
            checkbox.checked = true;
            checked.add(key);
        }
    }
});

function updateUrlParams(checkbox) {
    var currentUrl = window.location.href;
    const url = new URL(window.location);
    const urlParams = new URLSearchParams(url.search);
    if (checkbox.checked) {
        console.log(`Adding ${checkbox.value} to the URL query: ${currentUrl}`);
        urlParams.set(checkbox.value, true);
    } else {
        console.log(`Removing ${checkbox.value} from the URL query: ${currentUrl}`);
        urlParams.delete(checkbox.value);
    }
    url.search = urlParams.toString();
    history.pushState(null, null, url);
    console.log(`Updated URL query: ${window.location.href}`);
}

function createCheckbox(value, containerId) {
    var checkbox = document.createElement("input");
    checkbox.type = "checkbox";
    checkbox.value = value;
    checkbox.id = value;
    checkbox.name = "options";
    checkbox.onchange = function(event) {
        updateUrlParams(checkbox);
    }
    var label = document.createElement("label");
    label.htmlFor = value;
    label.innerHTML = value;

    var container = document.getElementById(containerId);
    container.appendChild(checkbox);
    container.appendChild(label);
    container.appendChild(document.createElement("br"));
}

// Create checkboxes for ignoredPaths
for (var path in ignoredPaths) {
  if (ignoredPaths.hasOwnProperty(path)) {
    createCheckbox(path, "filterPaths");
  }
}

// Create checkboxes for ignoredNames
for (var name in ignoredNames) {
  if (ignoredNames.hasOwnProperty(name)) {
    createCheckbox(name, "filterNames");
  }
}





// // this stuffs the entire objects into the url
// function onCheckCallback(checkbox, isPath) {
//     var obj = isPath ? ignoredPaths : ignoredNames;
//     if (checkbox.checked) {
//         delete obj[checkbox.value];
//     } else {
//         obj[checkbox.value] = true;
//     }

//     // Get the current URL
//     var currentUrl = new URL(window.location.href);

//     // Create a new URLSearchParams object from the current URL's search params
//     var searchParams = new URLSearchParams(currentUrl.search);

//     // Update the search params with the new values
//     if (isPath) {
//         searchParams.set("ignoredPaths", JSON.stringify(ignoredPaths));
//     } else {
//         searchParams.set("ignoredNames", JSON.stringify(ignoredNames));
//     }

//     // Update the current URL's search params
//     currentUrl.search = searchParams.toString();

//     // Update the URL in the address bar
//     window.history.pushState({}, "", currentUrl.toString());
// }


// Create header for filterPaths column
var filterPathsHeader = document.createElement("h3");
filterPathsHeader.innerHTML = "Filter Paths";
document.getElementById("filterPaths").prepend(filterPathsHeader);

// Create header for filterNames column
var filterNamesHeader = document.createElement("h3");
filterNamesHeader.innerHTML = "Filter Names";
document.getElementById("filterNames").prepend(filterNamesHeader);

var filterPathsContainer = document.getElementById("filterPaths");
var filterNamesContainer = document.getElementById("filterNames");

var instructionText = "These elements are normally excluded. Select them to include them.";
var filterPathsInstruction = document.createElement("p");
filterPathsInstruction.innerHTML = instructionText;
filterPathsContainer.appendChild(filterPathsInstruction);

var filterNamesInstruction = document.createElement("p");
filterNamesInstruction.innerHTML = instructionText;
filterNamesContainer.appendChild(filterNamesInstruction);








// // detect when they're changed
// options.forEach(function(option) {
//     var checkbox = document.getElementById(option);

//     selectedOptions = options.filter(function(option) {
//       return document.getElementById(option).checked;
//     });

//     checkbox.onchange = function() {
//         if (checkbox.checked) {
//             // Do something when the checkbox is checked
//             console.log("checked");
//         } else {
//             // Do something when the checkbox is unchecked
//             console.log("unchecked");
//         }
//         var selectedOptions = options.filter(function(option) {
//             return document.getElementById(option).checked;
//         });
//         console.log(selectedOptions);

//     };
// });

// // detect when the checkboxes are changed
// options.forEach(function(option) {
//     var checkbox = document.getElementById(option);
//     checkbox.onchange = function() {
//         var selectedOptions = options.filter(function(option) {
//             return document.getElementById(option).checked;
//         });
//         console.log("inopt: " + selectedOptions);

//         // reset ignoredPaths to its default state
//         ignoredPaths = {
//           ".//personal": true,
//           ".//journals/journal": true,
//           ".//skills": true,
//           ".//spellsmemorized/spell": true,
//           ".//minions/": true,
//         };

//         // modify ignoredPaths based on the selected options
//         if (!selectedOptions.includes("everything else")) {
//             // if "spells" is selected, we only want to ignore paths that don't start with .//spellsmemorized/
//             if (selectedOptions.includes("spells")) {
//                 ignoredPaths = {
//                   ".//spellsmemorized/": false
//                 };
//             }
//             // if "skills" is selected, we only want to ignore paths that don't start with .//skills/
//             if (selectedOptions.includes("skills")) {
//                 ignoredPaths = {
//                   ".//skills/": false
//                 };
//             }
//         }
//     };
// });




// var selectedOptions = options.filter(function(option) {
//     return document.getElementById(option).checked;
// });
// console.log(selectedOptions);
// });


</script>


    </div>
      <div class="main-container main-container-flex">
        <div class="page-header"></div>
        <div class="grid-container"></div>
        <div class="page-footer"></div>
      </div>
  </body>
</html>

<!-- // END OF FILE -->
